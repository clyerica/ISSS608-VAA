---
title: "Programming Animated Statistical Graphics with R"
format: html
author: "Erica Chan"
date: "01-26-2026"
date-modified: "last-modified"
number-sections: true
---

## Overview

### Learning objectives

-   Learn how to create animated data visualisations using **gganimate** and **plotly r** packages.
-   Learn how to reshape data with **tidyr** package
-   learn how to process, wrangle and transform data with **dplyr** package.

### Basic concepts of an animation

When creating animations, the plot does not actually move. Instead, many individual plots are built and then stitched together as movie frames, just like an old-school flip book or cartoon. Each frame is a different plot when conveying motion, which is built using some relevant subset of the aggregate data. The subset drives the flow of the animation when stitched back together.

![](https://r4va.netlify.app/chap04/img/image1.jpg)

### Terminology

Before we dive into the steps for creating an animated statistical graph, it’s important to understand some of the key concepts and terminology related to this type of visualization.

1.  **Frame**: In an animated line graph, each frame represents a different point in time or a different category. When the frame changes, the data points on the graph are updated to reflect the new data.
2.  **Animation Attributes**: The animation attributes are the settings that control how the animation behaves. For example, you can specify the duration of each frame, the easing function used to transition between frames, and whether to start the animation from the current frame or from the beginning.

## Getting started

### Loading R packages

First, the following code chunk will check, install and load the following R packages:

-   [**plotly**](https://plotly.com/r/), R library for plotting interactive statistical graphs.
-   [**gganimate**](https://gganimate.com/), an ggplot extension for creating animated statistical graphs.
-   [**gifski**](https://cran.r-project.org/web/packages/gifski/index.html) converts video frames to GIF animations using pngquant’s fancy features for efficient cross-frame palettes and temporal dithering. It produces animated GIFs that use thousands of colors per frame.
-   [**gapminder**](https://cran.r-project.org/web/packages/gapminder/index.html): An excerpt of the data available at Gapminder.org. We just want to use its *country_colors* scheme.
-   [**tidyverse**](https://www.tidyverse.org/), a family of modern R packages specially designed to support data science, analysis and communication task including creating static statistical graphs.

```{r}
pacman::p_load(readxl, gifski, gapminder,
               plotly, gganimate, tidyverse)
```

### Importing the data

In this hands-on exercise, the *Data* worksheet from *GlobalPopulation* Excel workbook will be used.

The next code chunk will import Data worksheet from GlobalPopulation Excel workbook by using appropriate R package from tidyverse family.

```{r}
col <- c("Country", "Continent")
globalPop <- read_xls("data/GlobalPopulation.xls",
                      sheet="Data") %>%
  mutate(across(col, as.factor)) %>%
  mutate(Year = as.integer(Year))

glimpse(globalPop)
```

::: callout-info
-   [`read_xls()`](https://readxl.tidyverse.org/reference/read_excel.html) of **readxl** package is used to import the Excel worksheet.
-   `mutate(across(col, as.factor))` uses **dplyr** functions to convert data from the columns defined in `col` into factor type.
    -   `mutate_at(col, as.factor)` could also be used to derive the same output
-   `mutate` of dplyr package is used to convert data values of Year field into integer.
-   `glimpse()` provides a transposed overview of the data to check that all the above steps transformed the data as expected
:::

## Animated Data Visualisation: gganimate methods

[**gganimate**](https://gganimate.com/) extends the grammar of graphics as implemented by ggplot2 to include the description of animation. It does this by providing a range of new grammar classes that can be added to the plot object in order to customise how it should change with time.

-   `transition_*()` defines how the data should be spread out and how it relates to itself across time.
-   `view_*()` defines how the positional scales should change along the animation.
-   `shadow_*()` defines how data from other points in time should be presented in the given point in time.
-   `enter_*()/exit_*()` defines how new data should appear and how old data should disappear during the course of the animation.
-   `ease_aes()` defines how different aesthetics should be eased during transitions.

### Building a static vs animated population bubble plot

::: panel-tabset
#### Static

```{r}
#| fig-width: 8
ggplot(globalPop, aes(x = Old, y = Young, 
                      size = Population, 
                      colour = Country)) +
  geom_point(alpha = 0.7, 
             show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  labs(title = 'Year: {frame_time}', 
       x = '% Aged', 
       y = '% Young') 
```

The code chunk above uses basic ggplot2 functions to create a static plot

#### Animated

```{r}
#| fig-width: 8
ggplot(globalPop, aes(x = Old, y = Young, 
                      size = Population, 
                      colour = Country)) +
  geom_point(alpha = 0.7, 
             show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  labs(title = 'Year: {frame_time}', 
       x = '% Aged', 
       y = '% Young') +
  transition_time(Year) +       
  ease_aes('linear')  
```

This code chunk uses:

-   `transition_time()` of gganimate to create transition through distinct states in time (i.e. Year).
-   `ease_aes()` to control easing of aesthetics. The default is linear. Other methods are: quadratic, cubic, quartic, quintic, sine, circular, exponential, elastic, back, and bounce
:::

## Animated Data Visualisation: plotly

In **Plotly R** package, both `ggplotly()` and `plot_ly()` support key frame animations through the `frame` argument/aesthetic. They also support an `ids` argument/aesthetic to ensure smooth transitions between objects with the same id (which helps facilitate object constancy).

### Building an animated bubble plot: `ggplotly()` method

In this sub-section, we will create an animated bubble plot by using `ggplotly()` method.

This bubble plot includes a play/pause button and a slider to control the animation

```{r}
#| warning: false
gg <- ggplot(globalPop, 
       aes(x = Old,  
           y = Young, 
           size = Population, 
           colour = Country)
       ) +
  geom_point(aes(size = Population,
                 frame = Year,
                 ids=Country),
             alpha = 0.7, 
             show.legend = FALSE) +
  scale_colour_manual(values = country_colors) +
  scale_size(range = c(2, 12)) +
  labs(x = '% Aged', 
       y = '% Young') + 
  theme(legend.position='none')

ggplotly(gg)
```

::: callout-info
-   Appropriate ggplot2 functions are used to create a static bubble plot. The output is then saved as an R object called *gg*.
-   `ggplotly()` is then used to convert the R graphic object into an animated svg object.
-   `theme(legend.position='none'` is necessary although `show.legend = FALSE` was used as otherwise, the legend will still appear on the plot.
-   the warning "Ignoring unknown aesthetics: frame" is because the *frame* argument is used by ggplotly(), not by ggplot2
:::

###  Building an animated bubble plot: `plot_ly()` method

In this sub-section, we will create an animated bubble plot by using `plot_ly()` method.

```{r}
#| warning: false
bp <- globalPop %>%
  plot_ly(x = ~Old, 
          y = ~Young, 
          size = ~Population, 
          color = ~Continent,
          sizes = c(2, 100),
          frame = ~Year, 
          text = ~Country, 
          hoverinfo = "text",
          type = 'scatter',
          mode = 'markers'
          ) %>%
  layout(showlegend = FALSE)
bp
```
